# docker box definition
box: ubuntu:xenial

# defining the dev pipeline
build:
  steps:
    - install-packages:
      packages: git build-essential zip unzip python-pip python tree curl bash
    - script:
      name: Initialize git submodules
      code: |
        git submodule update --init --recursive
    - script:
      name: Install NodeJS from data-chan script
      code: |
        bash data-chan/scripts/install-node.sh
    - script:
      name: NPM Install
      code: |
        npm install
    - script:
      name: Download Data-chan executable
      code: |
        pip install -r data-chan/scripts/requirements.txt
        (cd data-chan && python scripts/post-build-hook.py --bucket data-chan-js-binaries --download ../)
    - script:
      name: Pack NPM module
      code: |
        npm pack
        curl --upload-file ./data-chan-*.tgz https://transfer.sh/data-chan.tgz 
deploy:        
  steps:
    - turistforeningen/npm-publish@2.0.2
          
  after-steps:
    - wantedly/pretty-slack-notify:
        webhook_url: $SLACK_API_TOKEN 
